## 一、项目概述

### 1.1 作业背景
MuJoCo 是一款高性能、多自由度的物理仿真引擎，广泛应用于机器人控制、运动规划与强化学习等领域。通过 MuJoCo 提供的 MPC 控制框架，可以在仿真环境中实现对复杂系统的实时控制。本次作业以“汽车运动控制与可视化”为主题，综合运用 MuJoCo 仿真、MPC 控制和 OpenGL 图形渲染技术，实现一个具有实时仪表盘显示功能的小车仿真系统。

### 1.2 实现目标
- 构建一个可运动的汽车模型  
- 使用 MPC 控制汽车前进与转向  
- 实时获取车辆关键状态数据  
- 设计并实现汽车仪表盘可视化界面  

### 1.3 开发环境
- 操作系统：Ubuntu 22.04  
- 编译器：gcc 11.3.0  
- CMake：3.22.1  
- MuJoCo：2.x  

---

## 二、技术方案

### 2.1 系统架构设计
系统整体架构分为三层：

1. 物理仿真层  
   由 MuJoCo 引擎负责，计算车辆的动力学状态与关节运动。

2. 控制层  
   基于 MPC 的控制模块，根据目标位置与当前状态计算控制量。

3. 可视化层  
   使用 OpenGL 对车辆状态进行仪表盘形式的图形化显示。

### 2.2 数据流程分析
车辆在仿真过程中产生状态数据，这些数据由 MuJoCo 的 `mjData` 结构体提供。控制层使用部分状态作为输入计算控制量，同时可视化层从状态数据中提取速度、转速等信息，并将其转换为图形元素进行绘制。

### 2.3 渲染方案说明
仪表盘采用二维正交投影方式绘制。在 MuJoCo 完成三维场景渲染后，通过 OpenGL 在屏幕空间叠加绘制仪表盘，从而避免对原有三维渲染流程的影响。

---

## 三、实现细节

### 3.1 场景与模型创建
汽车模型通过 MJCF 文件定义，包括车体、车轮、关节以及执行器。车轮通过关节与车体连接，执行器控制轮子的转动，从而实现车辆前进与转向。

### 3.2 数据获取与处理
通过 MuJoCo 提供的接口读取车辆速度、关节力矩以及车体位姿等信息，并将其整理为仪表盘模块所需的数据格式，保证数据更新的实时性与一致性。

### 3.3 仪表盘渲染实现

#### 3.3.1 速度表
速度表采用圆形刻度盘形式，根据车辆线速度计算指针角度。刻度与指针均使用 OpenGL 基本图元绘制，指针角度随速度变化实时更新。

#### 3.3.2 转速表
转速表与速度表结构类似，但刻度范围更大，并在高转速区域加入颜色提示，以增强可读性。

### 3.4 系统联动
仪表盘渲染模块与仿真主循环紧密结合，保证每一帧渲染时所显示的数据均为最新仿真状态。

---

## 四、问题与解决方案

### 问题一：OpenGL 状态污染
- 现象：仪表盘绘制后三维场景显示异常  
- 原因：未正确恢复 OpenGL 矩阵与状态  
- 解决方法：在绘制前后显式保存并恢复 OpenGL 状态  

### 问题二：编译过程中出现 unused-function 错误
- 现象：编译失败并提示未使用函数  
- 原因：工程开启了 -Werror 编译选项  
- 解决方法：删除未使用函数或使用 `[[maybe_unused]]` 标注  

---

## 五、测试与结果分析

### 5.1 功能测试
测试结果表明，车辆能够在仿真环境中稳定运行，仪表盘数据与车辆状态保持一致。

### 5.2 性能测试
在普通桌面计算机上运行时，系统帧率稳定，CPU 占用较低，满足实时仿真与显示需求。

### 5.3 可视化效果
仪表盘显示清晰，指针运动平滑，能够直观反映车辆运动状态。

---

## 六、总结与展望

### 6.1 学习收获
通过本次作业，加深了对 MuJoCo 仿真机制、MPC 控制思想以及 OpenGL 渲染流程的理解。

### 6.2 不足之处
当前仪表盘功能较为基础，交互性和扩展性仍有提升空间。

### 6.3 未来改进方向
后续可以增加路径显示、小地图功能以及更丰富的车辆状态信息展示。

---

## 七、参考资料
- MuJoCo 官方文档  
- MuJoCo MPC 示例代码  
- OpenGL 编程指南  